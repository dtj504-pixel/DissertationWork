name: Time test

on: workflow_dispatch


jobs:
  timing-tests:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Setup R
        uses: r-lib/actions/setup-r@v2

      - name: Install R packages
        run: |
          Rscript -e 'install.packages(c("DiceKriging","dplyr","plot3D","stats"))'
      
      - name: Setup virtual display
        run: |
          sudo apt-get update
          sudo apt-get install -y xvfb
          export DISPLAY=:99
          Xvfb :99 -screen 0 1024x768x24 > /dev/null 2>&1 &
      
      - name: Time File 0
        run: |
          export DISPLAY=:99
          echo "Timing case_study8..."
          start=$(date +%s.%N)
          Rscript case_study8.R
          end=$(date +%s.%N)
          runtime=$(echo "$end - $start" | bc)
          echo "FILE0_TIME=${runtime}" >> $GITHUB_ENV
      
      - name: Time File 1
        run: |
          export DISPLAY=:99
          echo "Timing looped_ver_case_study8_multi_point_EI ..."
          start=$(date +%s.%N)
          Rscript looped_ver_case_study8_multi_point_EI.R
          end=$(date +%s.%N)
          runtime=$(echo "$end - $start" | bc)
          echo "FILE1_TIME=${runtime}" >> $GITHUB_ENV
      
      - name: Time File 2
        run: |
          export DISPLAY=:99
          echo "Timing looped_ver_case_study8_multi_point_AEI..."
          start=$(date +%s.%N)
          Rscript looped_ver_case_study8_multi_point_AEI.R
          end=$(date +%s.%N)
          runtime=$(echo "$end - $start" | bc)
          echo "FILE2_TIME=${runtime}" >> $GITHUB_ENV
      
      - name: Time File 3
        run: |
          export DISPLAY=:99
          echo "Timing looped_ver_case_study8_KG..."
          start=$(date +%s.%N)
          Rscript looped_ver_case_study8_KG.R
          end=$(date +%s.%N)
          runtime=$(echo "$end - $start" | bc)
          echo "FILE3_TIME=${runtime}" >> $GITHUB_ENV
      
      - name: Summary
        run: |
          echo "=== Execution Time Summary ==="
          echo "case_study8: ${FILE0_TIME}s"
          echo "looped_ver_case_study8_multi_point_EI: ${FILE1_TIME}s"
          echo "looped_ver_case_study8_multi_point_AEI: ${FILE2_TIME}s"
          echo "looped_ver_case_study8_KG: ${FILE3_TIME}s"